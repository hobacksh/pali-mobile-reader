# 번역 워크플로우 (로컬 corpus 기준)

이 프로젝트는 `pali-mobile-reader/data/corpus`를 기준으로 번역합니다.

## 규칙

- 원문 경로: `data/corpus/romn/<file>.xml`
- 번역 경로: `data/corpus/ko/<file>.xml`
- **파일명은 원문과 동일**하게 유지합니다.

예:
- 원문: `data/corpus/romn/vin01m.mul.xml`
- 번역: `data/corpus/ko/vin01m.mul.xml`

## 에이전트 기반 번역 단계 (Manual/Agentic Process)

대형 언어 모델(LLM)을 사용하여 매뉴얼하게 번역을 진행할 경우 다음 단계를 따릅니다.

1. **로그 확인**: `data/corpus/ko/log/translation_log.md`를 읽어 현재 진행률을 확인합니다.
2. **청크 읽기**: `data/corpus/ko/chunks/` 디렉토리에서 다음 번역할 대상 청크(예: 8개 단위)를 `view_file`로 순차적으로 읽습니다.
3. **내용 분석 및 전략 수립**:
   - **반복성(Cakka) 확인**: 문장 구조가 반복되는 패턴 구간인지 확인합니다.
   - **서사 밀도 확인**: 이야기나 복잡한 판례가 많은 구간인지 확인합니다.
4. **분할 출력**: 출력 토큰 제한으로 인한 누락을 방지하기 위해, 읽기 범위가 8개 청크더라도 **번역문 출력은 4개씩 나누어서** 수행하는 것을 권장합니다.
5. **파일 반영**: 번역된 내용을 대상 XML 파일에 `cat` 또는 편집 도구로 반영합니다.
6. **로그 업데이트**: 번역 일시, 청크 범위, 주요 내용을 로그 파일에 기록합니다.

## 누락 방지 및 품질 관리 (Omission Prevention)

- **태그 매핑 (Tag-to-Tag Mapping)**: 원문의 모든 XML 태그(`<p>`, `<pb>`, `<hi>` 등)를 보존하며, 번역문에서도 동일한 구조가 유지되는지 대조합니다.
- **절 번호(§) 검증**: 번역 시작점의 절 번호와 끝점의 절 번호가 원문과 일치하는지 최종 확인합니다.
- **다단 출력 전략**: 내용이 방대할 경우 한 번의 응답에 모두 담지 않고, 반드시 섹션을 나누어 출력함으로써 중간 생략이나 요약을 방지합니다.
- **중략(`...pe...`) 처리**: 팔리어 특유의 중략 표시가 있을 경우, 맥락상 중요한 변동 사항이 있는지 확인하고 적절히 한국어로 풀어서 설명하거나 형식을 유지합니다.

## 파일 간 일관성 및 확장 (Multi-file Consistency)

현재는 `vin01m.mul.xml`을 번역하고 있으나, 다른 팔리 성전 파일(예: `vin02m...`)로 확장될 때도 동일한 품질을 유지하기 위해 다음을 준수합니다.

- **범용 용어 사전(Glossary) 준수**: 파일이 바뀌어도 핵심 불교 전문 용어와 관용구(예: '상인법', '거츠루장', '악작' 등)의 번역어는 프로젝트 전체에서 일관되어야 합니다.
- **로그의 정보 명확화**: 
  - `translation_log.md` 기록 시, 어떤 파일의 몇 번째 청크인지 파일명을 명시하여 소속을 명확히 합니다.
- **청크 관리**: 
  - 각 원문 파일에 해당하는 청크 디렉토리를 확인하고, 파일 switch 시 이전 파일의 상태와 섞이지 않도록 주의합니다.
- **파일별 특이사항 기록**: 특정 파일에만 나타나는 고유한 태그 형식이나 패턴이 있을 경우, 이를 워크플로우나 로그에 기록하여 일관성을 유지합니다.

## 메인 번역 프로세스: 에이전트 협업 방식 (Interactive Agent Process)

이 프로젝트는 자동화 스크립트보다는 **AI 에이전트와의 실시간 협업**을 통한 정밀 번역을 우선합니다. 다른 세션이나 다른 작업자가 참여하더라도 다음의 인터랙티브 프로세스를 유지해야 합니다.

1. **컨텍스트 로딩**: 새로운 세션 시작 시 에이전트에게 `TRANSLATION_WORKFLOW.md`와 `translation_log.md`를 먼저 읽게 하여 프로젝트 규칙과 현재 상태를 동기화합니다.
2. **청크 단위 작업**: 한 번에 4~8개의 청크를 읽고, 에이전트가 번역 전략(반복문 구조 처리 등)을 먼저 보고한 뒤 번역을 수행합니다.
3. **태그 보존 중심**: 텍스트보다 XML 구조(태그)의 보존을 최우선으로 하며, 번역문 삽입 시 `cat`이나 `replace_file_content` 도구를 사용하여 원본 파일의 무결성을 지킵니다.
4. **대화형 검증**: 번역 누락이 의심되거나 용어가 모호할 경우 에이전트가 사용자에게 질문하고, 사용자는 피드백을 주어 품질을 실시간으로 교정합니다.

### (Legacy/Alternative) 스크립트 실행
*참고: 아래는 이전 자동화 방식의 흔적이며, 현재는 위의 에이전트 협업 방식을 권장합니다.*

```bash
# 사용 권장되지 않음 (참고용)
./scripts/translate_local_corpus_with_codex.sh --file vin01m.mul.xml
```

## 참고

- 과거 `vin01m.mul0.ko.xml` 같은 이름은 이전 실험 산출물의 흔적입니다.
- 현재 운영 규칙은 `romn/<file>.xml` ↔ `ko/<file>.xml` 1:1 대응입니다.
